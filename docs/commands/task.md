# Gok task

Scope: `Project`, `Service`

`Gok task` provides a tool to manage and execute a defined command from inside your meta yaml files.

## Pull

### Command: gok task pull namespace [name]

`Gok` allows you to pull predefined tasks from the `gokums-cli` github repo and put it into your meta file.
If you're in `Service` scope, pulled task is populated into `manifest.yaml`, or in the case of `Project` scope, task is put into `root.yaml`

If you don't specify `name`, `Gok` will list out all tasks on that namespace.
If the namespace does not exist, current available namespaces are `go`, `docker` and `local`

## Run

### Command: gok task run name

`Gok` merges tasks from `Project` scope and `Service` scope, then executes the combined task.
tFor how the tasks are merged, refer to [root.yaml configuration](../others/root.yaml.md).

`Gok` runs task by [templating](../others/templating.md) steps, judging whether to perform it or not by evaluating the `when` property, and executing them serially one after each other.

As an example, rRefer to the task called `build`, which is generated by default
It performs building a binary by calling `go build`.

## Run Predefined task

### Command: gok task run-predefined namespace name

`Gok` combines a temporary pull task and run task, it fetches the task, doesn't save anywhere, and perform a run on it.

## tools.next

If you notice, there's one piece called `tools.next('http', 1000)` in the `metadata.vars.port`, `next(key, startNum)` is a function that for each unique key, it creates a generator starts from `startNum`. So the first call of `tools.next('http', 1000)` will return `1000`, and the second call will return `1001`... You can use this tool to tell `Gok` to assign himself a port for every different service.

## tools.which

`tools.which` provides you a great way to know if a tool exists or not, for example this task install `cloudsql_proxy` if it doesn't exist:

```YAML
tasks:
    cloudsql-proxy:
        steps:
        - name: Install cloud_sql_proxy
            cmd: go get github.com/GoogleCloudPlatform/cloudsql-proxy/cmd/cloud_sql_proxy
            when: <%= tools.which('cloud_sql_proxy') === "" %b>
```







